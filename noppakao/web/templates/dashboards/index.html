{% extends "base/default-page.html" %}

{% block content %}
<style>
    .dashboard-box {
        color: rgb(255, 255, 255);
        height: 50px;
        background-color:rgb(50, 78, 156);
        border: 1px solid rgb(123, 123, 123);
        border-radius: 5px;
        text-align: center;
        line-height: 50px;
        font-family: monospace;
        font-size: 20px;
        margin-bottom: 30px;
    }

    .table-container {
        margin-bottom: 20px;
    }

    .left-aligned {
        text-align: left;
    }

    .no-margin .row {
        margin: 0 !important;
        padding: 0 !important;
    }


    @keyframes flash {
        0% {
            opacity: 1;
        }

        50% {
            opacity: 0;
        }

        100% {
            opacity: 1;
        }
    }

    .flash-red {
        color: red;
        animation: flash 1s infinite;
    }
</style>

<div class="dashboard-box">
    Leaderboard
</div>

{#NEW#}
<div class="ui grid no-margin">
    <div class="two column row">
        <div class="column">
                <table class="ui inverted table">
                    <thead style="background-color:rgb(50, 78, 156)">
                        <tr>
                            <th scope="col" style="color: rgb(255, 255, 255);">Team Rank</th>
                            <th scope="col" style="color: rgb(255, 255, 255); text-align: right;">Updated every 1 minutes</th>
                        </tr>
                    </thead>
                </table>
        </div>
        <div class="column">
                <table class="ui inverted table">
                    <thead style="background-color:rgb(50, 78, 156)">
                        <tr>
                            <th scope="col" style="color: rgb(255, 255, 255);">Individual Rank</th>
                            <th scope="col"  style="color: rgb(255, 255, 255); text-align: right;">
                                <span class="transparent-bg">Countdown timer :		
                                    <a class="item" style="color: white;">
                                        <span id="countdown"></span>
                                    </a>
                                </span>
                            </th>
                        </tr>
                    </thead>
                </table>
        </div>
    </div>
    
    {#SCORE BOARD#}
    <div class="two column row">
        <div class="column">
            <div class="table-container">
                <table class="ui inverted table" >
                    <thead style="background-color:rgb(50, 78, 156);">
                        <tr >
                            <th scope="col" style="color: rgb(255, 255, 255);">Raking</th>
                            <th></th>
                            <th scope="col" style="color: rgb(255, 255, 255);">Team</th>
                            <th scope="col" class="left-aligned" style="color: rgb(255, 255, 255);">Score</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for team in teams %}
                            {% if loop.index % 2 != 0 %}
                            <tr style="color: rgb(0, 0, 0); background-color: rgb(200, 200, 200)">
                            {% else %}
                            <tr style="color: rgb(0, 0, 0); background-color: rgb(180, 180, 180)">
                            {% endif %}
                            <td>{{ loop.index }}</td>
                            <td>
                                {% if team.picture %}
                                <h3 class="ui picture header" >
                                    <img src="{{team.get_picture()}}" style="width: 20px; height: 20px;">
                                </h3>
                                {% else %}
                                <div>
                                    No Picture
                                </div>
                                {% endif %}
                            </td>
                            <td>{{ team.name }}</td>
                            {% if not team.score %}
                            <td class="left-aligned">0</td>
                            {% else %}
                            <td class="left-aligned">{{ team.score }}</td>
                            {% endif %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        <div class="column">
            <div class="table-container">
                <table class="ui inverted table">
                    <thead style="background-color:rgb(50, 78, 156);">
                        <tr>
                            <th scope="col" style="color: rgb(255, 255, 255);">Raking</th>
                            <th></th>
                            <th scope="col" style="color: rgb(255, 255, 255);">Name</th>
                            <th scope="col" style="color: rgb(255, 255, 255);">Team</th>
                            <th scope="col" class="left-aligned" style="color: rgb(255, 255, 255);">Score</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for user in users %}
                            {% if loop.index % 2 != 0 %}
                                <tr style="color: rgb(0, 0, 0); background-color: rgb(200, 200, 200)">
                            {% else %}
                                <tr style="color: rgb(0, 0, 0); background-color: rgb(180, 180, 180)">
                            {% endif %}
                            <td>{{ loop.index }}</td>
                            <td>No Picture</td>
                            <td>{{ user.display_name }}</td>
                            <td>{{ user.get_fullname() }}</td>
                            {% if not user.score %}
                                <td class="left-aligned">0</td>
                            {% else %}
                                <td class="left-aligned">{{ user.score }}</td>
                            {% endif %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}


{% block additional_js %}

<script type="text/javascript">
	function countdown(ended_date) {
		const countDownDate = new Date(ended_date).getTime();

		const x = setInterval(function () {
			const now = new Date().getTime();
			const distance = countDownDate - now;

			const days = Math.floor(distance / (1000 * 60 * 60 * 24));
			const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
			const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
			const seconds = Math.floor((distance % (1000 * 60)) / 1000);

			document.getElementById("countdown").innerHTML = '<i class="clock outline icon"></i>' + days + "d " + hours + "h "
				+ minutes + "m " + seconds + "s ";

			if (distance < 0) {
				clearInterval(x);
				document.getElementById("countdown").innerHTML = '<i class="clock outline icon"></i> Out Of Time';
				document.getElementById("countdown").classList.add("flash-red");
			}
		}, 1000);
	}

	window.onload = function () {
		const ended_date = "{{ event.ended_date }}";
		console.log("Initial Ended Date:", ended_date);
		countdown(ended_date);
	}
</script>

<script type="text/javascript">
	function updateTime() {
		const now = new Date();
		let hours = (now.getUTCHours() + 7) % 24; 
		let minutes = now.getUTCMinutes();
		hours = hours < 10 ? '0' + hours : hours;
		minutes = minutes < 10 ? '0' + minutes : minutes;
		document.getElementById('time-display').innerHTML = `${hours}:${minutes} (UTC+7)`;
	}
	setInterval(updateTime, 1000);
	updateTime();
</script>
{% endblock additional_js %}