{% extends "base/default-page.html" %}

{% block content %}
<div class="ui secondary menu" style="font-size: medium;">
	<div class="item">
		<h3><i class="star icon"></i> Challenges</h3>
	</div>
	<div class="item">
		<i class="user friends icon"></i> Team Rank
	</div>
	<div class="right menu">
		<div class="item">
			<i class="user friends icon"></i> Team Score 0
		</div>
		<div class="item">
			<i class="user friends icon"></i> Team Rank 0
		</div>
	</div>
</div>
<div class="ui grid center aligned">
	{% for i in range((event_categorys|length)) %}
	<div class="five wide column card-trigger" id="card-template">
		<div class="ui cards">
			<div class="ui fluid card">
				<div class="content">
					<div class="header">
						<i class="chess queen icon" style="visibility: visible;"></i>
						Question Category {{ event_categorys[i].name }}
					</div>
					<div class="content" style="margin-top: 1rem;">
						<table class="ui table" style="border: none !important;">
							<thead>
								<tr>
									<th class="one wide"></th>
									<th class="six wide">Challenges</th>
									<th class="two wide center aligned">Point</th>
									<th class="two wide center aligned"><i class="tint icon" style="color: red;"></i>
									</th>
									<th class="two wide center aligned"><i class="key icon"
											style="color: rgb(255, 196, 0);"></i></th>
									<th class="two wide center aligned">Solves</th>
								</tr>
							</thead>
							<tbody>
								{% for event_challenge in event_challenges %}
								{% if event_categorys[i].name == event_challenge.challenge.category.name %}
								<tr class="clickable-row" data-challenge-id="{{ event_challenge.challenge.id }}">
									<td><i class="cube icon" style="color: #386CAF;"></i></td>
									<td class="clickable-name"><a>{{ event_challenge.challenge.name }}</a></td>
									<td class="center aligned">{{ event_challenge.success_score }}</td>
									<td class="center aligned">{{ event_challenge.first_blood_score }}</td>
									<td class="center aligned">{{ event_challenge.hint_score }}</td>
									<td class="center aligned">{{ event_challenge.fail_score }}</td>
								</tr>
								{% endif %}
								{% endfor %}
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>
	{% endfor %}
</div>

<div class="ui modal" id="challenge-modal">
	<div class="header">Challenge Details</div>
	<div class="content">
		<div class="ui segment">
			<p id="challenge-description" class="modal-description"></p>
			<p>
				<a id="challenge-url" href="#" target="_blank" class="ui link" style="display: none;">Challenge URL</a>
			</p>
		</div>
		<div id="challenge-hint" class="modal-hint ui blue segment" style="display: none;"></div>
		<a id="show-hint-button" class="ui primary tertiary button" style="display: none;"><i
				class="eye outline icon"></i>Show Hint</a>
		<form class="ui form" style="margin-top: 2rem;">
			<div class="field">
				<label>Answer Flag</label>
				<input type="text" name="answer-flag" placeholder="Answer Flag">
			</div>
		</form>
	</div>
	<div class="actions">
		<div class="ui button negative">Cancel</div>
		<div class="ui button positive">Submit</div>
	</div>
</div>




{% endblock %}

{% block additional_js %}
<script>
	function showChallengeDetails(challengeId) {
		$.ajax({
			url: '/api/challenge/' + challengeId,
			type: 'GET',
			success: function (response) {
				$('#challenge-description').text(response.description);

				if (response.challenge_url) {
					$('#challenge-url')
						.attr('href', response.challenge_url)
						.text(response.name)
						.show();
				} else {
					$('#challenge-url').hide();
				}

				if (response.hint) {
					$('#show-hint-button').show().off('click').on('click', function () {
						$('#challenge-hint').text(response.hint).show();
						$(this).hide();
					});
				} else {
					$('#show-hint-button').hide();
					$('#challenge-hint').hide();
				}
				$('#challenge-modal').modal('show');
			},
		});
	}

	$(document).ready(function () {
		$('.clickable-name').on('click', function () {
			var challengeId = $(this).closest('.clickable-row').data('challenge-id');
			if (challengeId) {
				showChallengeDetails(challengeId);
			}
		});

		$('#challenge-modal').modal({
			onHidden: function () {
				$('#challenge-hint').hide();
				$('#show-hint-button').show();
			}
		});
	});
</script>
{% endblock %}